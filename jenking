pipeline{
    agent any
    environment {
        SSH_KEY = credentials('f625a1cf-ac6e-4e49-a7d6-2db12ec65e07')
    }
    stages{
        stage("paso 1"){
            steps{
                echo 'Hello World 1'
            }
            
        }
        stage("paso 2"){
            steps{
                echo 'Hello World 1'
            }
        }
        stage('Deploy to EC2') {
            steps {
                script {
                    // Guardar la clave SSH temporalmente en un archivo
                    def privateKeyFile = "${env.WORKSPACE}/ec2_key.pem"
                    writeFile file: privateKeyFile, text: SSH_KEY

                    // Establecer los permisos de la clave para que SSH lo acepte
                    sh "chmod 400 ${privateKeyFile}"

                    // Conectarse a la instancia EC2 usando SSH
                    sh """
                        ssh  -i ${privateKeyFile} admin@ec2-34-228-113-27.compute-1.amazonaws.com "echo 'Conectado desde Jenkins'"
                    """

                    // Limpiar el archivo de clave despu√©s de usarlo
                    sh "rm -f ${privateKeyFile}"
                    
                }
            }
        }
    }
}